@model ITS.Domain.ViewModels.InternalTasksViewModel.InitialAssessmentQAViewModel
@using ITS.Infrastructure.Global;
@using System.Web.Script.Serialization
@{
    ViewBag.Title = "InitialAssessmnetQA";
    Layout = "~/Views/Shared/_LayoutBootstrap.cshtml";
}
@section AdditionalCss{
    <link rel="stylesheet" href="@Url.Content("~/Content/themes/base/jquery.ui.base.css")" />
    <link rel="stylesheet" href="@Url.Content("~/Content/themes/base/jquery.ui.theme.css")" />
   
    <link href="@Url.Content("~/Content/themes/base/jquery-ui-timepicker-addon.css")" rel="stylesheet" type="text/css" />
}
@section ContentHeader{
    <h1>
        Initial Assessment QA</h1>
}
@*<div id="divGridDisplaySpinner" style="position: absolute; top: 89%; left: 50%;bottom: 0%;">
    <div id="divGridDisplay">
    </div>
</div>*@
<div id="breadcrumb">
    <a href="@Url.Action(GlobalConst.Actions.InternalTasksController.Index, GlobalConst.Controllers.InternalTasks)" title="Go to Home" class="tip-bottom">
        <i class="icon-home"></i>Internal Tasks</a><a href="@Url.Action(@GlobalConst.Actions.InitialAssessmentController.Index, @GlobalConst.Controllers.InitialAssessment)" class="tip-bottom">Initial
            Assessment</a> <a href="#" class="tip-bottom">Initial Assessment QA</a>
</div>
<div class="container-fluid" id="divInitialAssessmentQA">
    <div class="row-fluid">
        <div class="span12">
            @using (Html.BeginForm(GlobalConst.Actions.InitialAssessmentController.UpdateInitialAssessmentQA, GlobalConst.Controllers.InitialAssessment, FormMethod.Post, new

            {
                @class = "form-horizontal",
                id = "frmUpdateInitialAssessmentQa",
                encript = "multipart/form-data",

                data_bind = "ajaxForm:{ success: function(responseText, statusText, xhr, $form){ UpdateInitialAssessment(responseText, statusText, xhr, $form); }, beforeSubmit: UpdateInitialAssesmentQAFormBeforeSubmit }"
            }))
            {


                @Html.AntiForgeryToken()
                //Patient info start
             
                
                <div class="widget-box">
                    <div class="widget-title">
                        <span class="icon"><i class="icon-align-justify"></i></span>
                        <h5>
                            Patient Details</h5>
                    </div>
                    <div class="widget-content nopadding">
                        <div>
                            <!--ko with:Patient -->
                            <div class="control-group">
                                <label class="control-label-inital">
                                    Patient Name:</label>
                                <div class="controls">
                                    <input type="text" name="PatientName" data-bind="value:FirstName()+' '+LastName()"
                                        placeholder="Patient Name" readonly />

                                    <input type="hidden" name="FirstName" data-bind="value:FirstName"/>
                                    <input type="hidden" name="LastName" data-bind="value:LastName"/>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label-inital">
                                    Date of Birth:</label>
                                <div class="controls">
                                    <input type="text" name="Patient.BirthDate" data-bind="value:BirthDate" placeholder="Date of Birth"
                                        readonly />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label-inital">
                                    Date of accident:</label>
                                <div class="controls">
                                    <input type="text" name="Patient.InjuryDate" data-bind="value:InjuryDate" placeholder="Date of accident"
                                        readonly />
                                </div>
                            </div>
                            <!--/ko-->
                            <!--ko with:Case -->
                            <div class="control-group">
                                <label class="control-label-inital">
                                    Date of Referral:
                                </label>
                                <div class="controls">
                                    <input type="text" name="CaseSubmittedDate" readonly data-bind="value:CaseSubmittedDate"
                                        placeholder="Date of Referral" />
                                </div>
                            </div>
                            <!--/ko-->


                             <!--ko with:CaseAppointmentDate -->
                            <div class="control-group">
                                <label class="control-label-inital">
                                    Date of Initial Assessment:</label>
                                <div class="controls">
                                    <input type="text" id="CaseAppointmentDateAppointmentDate" class="datepicker" data-bind="value:strAppointmentDate,jqBootstrapValidation: {}" data-validation-regex-message="DD/MM/YYYY" data-validation-regex-regex="^(0[1-9]|[12][0-9]|3[01])[- /.](0[1-9]|1[012])[- /.](19|20)\d\d+$"
                                        placeholder="Date of Intital Assessment" required  />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label-inital">
                                    Time of Initial Assessment:
                                </label>
                                <div class="controls">
                                    <input type="text" id="CaseAppointmentDateAppointmentTime" data-bind="value:strAppointmentTime,jqBootstrapValidation: {}" maxlength="7"
                                      data-validation-regex-regex="^([0-1][0-9]|2[0-3]):([0-5][0-9])$" placeholder="Time of Intital Assessment" required />
                                      <input type="hidden" name="CaseAppointmentDate.AppointmentDateTime" data-bind="value:$root.AppointmentDateTime()" />
                                </div>
                            </div>
                            <!--/ko-->
                           
                            <div class="control-group" data-bind="visible:Practitioners().length>0?true:false">
                                <label class="control-label-inital">
                                    Practitioners:</label>
                                <div class="controls">
                                    <select name="CaseAssessment.CaseAssessmentDetail.PractitionerID" class="select-set" data-bind="options:Practitioners,optionsText:'PractitionerFullName',optionsValue:'PractitionerID',value:PractitionerID">
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                //Patient info End

                //Case Assessment info start
                <!--ko with:CaseAssessment -->
        
                
                    
                 <input type="hidden" data-bind="value:IsSaved" name="CaseAssessment.IsSaved" />
                <input type="hidden" data-bind="value:CaseAssessmentRating.AssessmentServiceID" name="CaseAssessmentRating.AssessmentServiceID" />
                <input type="hidden" data-bind="value:AssessmentAuthorisationID" name="CaseAssessment.AssessmentAuthorisationID" />
                <input type="hidden" data-bind="value:CaseID" name="CaseAssessment.CaseID" />
                <input type="hidden" data-bind="value:UserID" name="CaseAssessment.UserID" />
                <input type="hidden" data-bind="value:CaseID" name="CaseAssessment.CaseAssessmentDetail.CaseID" />
                <input type="hidden" data-bind="value:CaseAssessmentDetail.CaseAssessmentDetailID"
                    name="CaseAssessment.CaseAssessmentDetail.CaseAssessmentDetailID" />
                <input type="hidden" data-bind="value:CaseAssessmentDetail.AdditionalInformation"
                    name="CaseAssessment.CaseAssessmentDetail.AdditionalInformation" />
                <input type="hidden" data-bind="value:AssessmentServiceID" name="CaseAssessment.CaseAssessmentDetail.AssessmentServiceID" />
                <input type="hidden" data-bind="value:AssessmentServiceID" name="CaseAssessment.AssessmentServiceID" />
                <input type="hidden" data-bind="value:CaseID" name="CaseCommunicationHistory.CaseID" />
                
              
                <input type="hidden" data-bind="value:CaseID" name="CaseAssessment.CaseAssessmentRating.CaseID" />
                <input type="hidden" data-bind="value:CaseAssessmentRating.CaseAssessmentRatingID"
                    name="CaseAssessment.CaseAssessmentRating.CaseAssessmentRatingID" />
                
               
               
              
                
                
                <div class="widget-box">
                    <div class="widget-title">
                        <span class="icon"><i class="icon-align-justify"></i></span>
                        <h5>
                            Patient Consent</h5>
                    </div>
                    <div class="widget-content">
                        <div class="form-group">
                            Has the patient given consent for this assessment report to be passed to their solicitor,the
                            treating physiotherapist and the funding party?:
                        <span class="pull-right">
                                <input class="radio inline" type="radio" data-bind="attr:{name:'CaseAssessment.HasPatientConsentForm'},checked:HasPatientConsentForm().toString()"
                                value="true" />
                            Yes
                            <input class="radio inline" type="radio" data-bind="attr:{name:'CaseAssessment.HasPatientConsentForm'},checked:HasPatientConsentForm().toString()"
                                value="false" />
                            No</span>
                        </div>
                    </div>
                </div>
               
                
                <div class="widget-box">
                    <div class="widget-title">
                        <span class="icon"><i class="icon-align-justify"></i></span>
                        <h5>
                            Injury and symptom details:</h5>
                    </div>
                    <div class="clear">
                    </div>
                    <div class="widget-content">
                        <div class="form-group">
                            <label>
                                Please give a brief description of the incident and diagnosis/injury. Please include
                                whether the patient attended and/or their GP:
                            </label>
                            <textarea class="form-control textarea-qurtr" name="CaseAssessment.IncidentAndDiagnosisDescription"
                                data-bind="value:IncidentAndDiagnosisDescription" required rows="3"></textarea>
                            <label>
                            </label>
                            <div class="clear">
                            </div>
                            <table class="table table-bordered table-striped table-hover sortable">
                                <thead>
                                    <tr>
                                        <th class="wd-ful-20">
                                            Symptom Description
                                        </th>
                                        <th class="wd-ful-20">
                                            Pain Score 
                                        </th>
                                        <th class="wd-ful-20">
                                             Affected Area
                                        </th>
                                        <th class="wd-ful-20">
                                            RestrictionRange
                                        </th>
                                        <th class="wd-ful-20">
                                            StrengthTesting
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                   <!--ko foreach: $root.CaseAssessmentPatientInjuries -->
                                    <tr>
                                        <td>
                                            <div class="control-group-input">
                                                @* <input type="text" class="textarea-full-97" data-bind="attr: { name: 'CaseAssessment.CaseAssessmentPatientInjuries['+ $index() + '].AffectedArea' },value:AffectedArea"
                                                required />*@

                                                <select class="select-full-wd" data-bind="options:$root.SymptomDescriptions,optionsText: 'SymptomDescriptionName',optionsValue:'SymptomDescriptionID',
                                                        value:SymptomDescriptionID,attr: { name: 'CaseAssessment.CaseAssessmentPatientInjuries['+ $index() + '].SymptomDescriptionID' ,id: 'dropdown_' + $index() },value:SymptomDescriptionID, click :$root.EnableTextBox">
                                                </select>
                                              
                                               <input type="text" class="x-large-wd mrg-t10" data-bind="attr: { name: 'CaseAssessment.CaseAssessmentPatientInjuries['+ $index() + '].OtherSymptomDesciption' ,id: 'prefix_' + $index() },value: OtherSymptomDesciption" disabled />
                        <input type="hidden" data-bind="attr: { name: 'CaseAssessment.CaseAssessmentPatientInjuries['+ $index() + '].OtherSymptomDesciption', id: 'hd_ID' + $index() }, value: OtherSymptomDesciption" />
                                            </div>
                                        </td>
                                        <td>
                                            <div class="control-group-input">
                                                <select id="DrpPainScore" class="select-s-half" data-bind="attr: { name: 'CaseAssessment.CaseAssessmentPatientInjuries['+ $index() + '].Score' },value: Score">
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">3</option>
                                                    <option value="4">4</option>
                                                    <option value="5">5</option>
                                                    <option value="6">6</option>
                                                    <option value="7">7</option>
                                                    <option value="8">8</option>
                                                    <option value="9">9</option>
                                                    <option value="10">10</option>
                                                </select>
                                            </div>
                                        </td>
                                        <td>
                                            
                                                <div class="control-group-input">
                                                    <select class="select-s-half" data-bind="options:$root.AffectedAreas, optionsText:'AffectedAreaDescription',optionsValue:'AffectedAreaID',
                                                                                       value:AffectedAreaID,attr: { name: 'CaseAssessment.CaseAssessmentPatientInjuries['+ $index() + '].AffectedAreaID' },value:AffectedAreaID">
                                                    </select>
                                                </div>
                                                @*  <input type="text" class="input-large" data-bind="attr: { name: 'CaseAssessment.CaseAssessmentPatientInjuries['+ $index() + '].Restriction' },value:Restriction" required />*@
                                                @*<textarea rows="2" cols="2" class="textarea-full-97" data-bind="attr: { name: 'CaseAssessment.CaseAssessmentPatientInjuries['+ $index() + '].Restriction' },value:Restriction"
                                                required></textarea>*@
                                          </td>
                                        <td>
                                            <div class="control-group-input">
                                                <select class="select-s-half" data-bind="options:$root.RestrictionRanges, optionsText:'RestrictionRangeDescription',optionsValue:'RestrictionRangeID',
                                                                                               value:RestrictionRangeID,attr: { name: 'CaseAssessment.CaseAssessmentPatientInjuries['+ $index() + '].RestrictionRangeID' },value:RestrictionRangeID">
                                                </select>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="control-group-input">
                                                <select class="select-s-half" data-bind="options:$root.StrengthTestings, optionsText:'StrengthTestingDescription',optionsValue:'StrengthTestingID',
                                                                                         value:StrengthTestingID,attr: { name: 'CaseAssessment.CaseAssessmentPatientInjuries['+ $index() + '].StrengthTestingID' },value:StrengthTestingID">
                                                </select>
                                            </div>
                                        </td>
                                    </tr>
                                     <input type="hidden" data-bind="attr: { name: 'CaseAssessment.CaseAssessmentPatientInjuries['+ $index() + '].CaseAssessmentDetailID' }, value: CaseAssessmentDetailID" />
                    <input type="hidden" data-bind="attr: { name: 'CaseAssessment.CaseAssessmentPatientInjuries['+ $index() + '].CaseAssessmentPatientInjuryID' }, value: CaseAssessmentPatientInjuryID" />
                                    <!--/ko-->
                                </tbody>
                            </table>
                        </div>
                        <div class="form-group">
                            <label>
                                Please detail any neural symptoms present with reference to the symptoms above:
                            </label>
                            <textarea class="form-control textarea-qurtr" name="CaseAssessment.NeuralSymptomDescription" data-bind="value:NeuralSymptomDescription"
                                rows="3"></textarea>
                        </div>
                    
                    <div class="row-set">
                        <label class="mrg-t10 wd-65 pull-left">
                         Please comment on relevant tests undertaken:
                     </label>
                   <span class="pul-rigt-30"> <input type="checkbox" name="NotApplicablesymptomsection" onclick="symptomsectiondescription(this);">Not Applicable </span> 
                    <div class="row2-textarea">
                        <textarea rows="3" cols="20" class="form-control textarea-qurtr" id="RelevantTestUndertaken" name="CaseAssessment.RelevantTestUndertaken"
                            data-bind="value:RelevantTestUndertaken" ></textarea>

                    </div>
                    <input type="hidden" id="hdRelevantTestUndertaken" name="CaseAssessment.hdRelevantTestUndertaken" data-bind="value:RelevantTestUndertaken" />
                        </div>
                </div>

                </div>
                <div class="widget-box">
                    <div class="widget-title">
                        <span class="icon"><i class="icon-align-justify"></i></span>
                        <h5>
                            Factors affecting treatment</h5>
                    </div>
                    <div class="widget-content">
                        <div class="form-group">
                            <label class="mrg-t10 wd-65 pull-left">
                                Please give a brief description of any pre-existing conditions which may affect
                                the patient’s recovery and return to work:
                            </label>
                           <span class="pul-rigt-30"> <input type="checkbox" name="NotApplicable" onclick="enableDescriptionArea(this);">Not Applicable </span>
                            <div class="row2-textarea">
                                <textarea id="PreExistingConditionDescription" class="form-control textarea-qurtr" rows="4" cols="20" name="CaseAssessment.PreExistingConditionDescription"
                                    data-bind="value: PreExistingConditionDescription" ></textarea>
                            </div>
                        </div>
                        <br />
                    </div>
                </div>
                <!--/ko-->
                @Html.Partial("InternalTask/_AddInjuryAndSymptomPartial")
                
                <div class="widget-box">
                    <div class="widget-title">
                        <span class="icon"><i class="icon-align-justify"></i></span>
                        <h5>
                            What color of flag does the patient demonstrate?
                        </h5>
                    </div>
                    <div class="widget-content">
                        <div class="form-group">
                            <!--ko with:CaseAssessment -->
                            <div class="clear">
                            </div>
                            <span class="label-line">Does the patient demostrate any Yellow Flags?</span>
                            <span class="pull-right">
                            <input type="radio" value="true" class="radio inline" data-bind="attr: { name: 'CaseAssessment.HasYellowFlags' },checked:$root.HasYellowFlags"
                                required />Yes
                            <input type="radio" value="false" class="radio inline" data-bind="attr: { name: 'CaseAssessment.HasYellowFlags' },checked:$root.HasYellowFlags"
                                required />No
                                </span>
                            <div class="clear">
                            </div>
                            <span class="label-line">Does the patient demostrate any Red Flags?</span>
                            <span class="pull-right">
                            <input type="radio" value="true" name="CaseAssessment.HasRedFlags" required class="radio inline"
                                data-bind="checked:$root.HasRedFlags" />Yes
                            <input type="radio" value="false" name="CaseAssessment.HasRedFlags" required class="radio inline"
                                data-bind="checked:$root.HasRedFlags" />No
                                </span>
                            <div class="clear">
                            </div>
                            <span class="label-line">Is the patient already undergoing any treatment? </span>
                            <span class="pull-right">
                            <input type="radio" value="true" name="CaseAssessment.IsPatientUndergoingTreatment"
                                class="radio inline" data-bind="checked:$root.IsPatientUndergoingTreatment" required />Yes
                            <input type="radio" value="false" name="CaseAssessment.IsPatientUndergoingTreatment"
                                class="radio inline" data-bind="checked:$root.IsPatientUndergoingTreatment" required />No
                                </span>
                            <div class="clear">
                            </div>
                            <span class="label-line">Is the patient currently taking any medication? </span>
                             <span class="pull-right">
                            <input type="radio" name="CaseAssessment.IsPatientTakingMedication" value="true"
                                class="radio inline" data-bind="checked:$root.IsPatientTakingMedication" required />Yes
                            <input type="radio" name="CaseAssessment.IsPatientTakingMedication" value="false"
                                class="radio inline" data-bind="checked:$root.IsPatientTakingMedication" required />No
                                 </span>
                            <div class="clear">
                            </div>
                            <span class="label-line">Does the patient require any further investigation? </span>
                             <span class="pull-right">
                            <input type="radio" name="CaseAssessment.PatientRequiresFurtherInvestigation" value="true"
                                data-bind="checked:$root.PatientRequiresFurtherInvestigation" class="radio inline" />Yes
                            <input type="radio" name="CaseAssessment.PatientRequiresFurtherInvestigation" value="false"
                                data-bind="checked:$root.PatientRequiresFurtherInvestigation" class="radio inline" />No
                                 </span>
                            <div class="clear">
                            </div>
                            <br />
                            <div class="form-group" data-bind="style:{display:($root.PatientRequiresFurtherInvestigation()=='true') ?'block':'none'}">
                                <label>
                                    If yes, please detail:
                                </label>
                                <textarea class="form-control textarea-qurtr" name="CaseAssessment.FactorsAffectingTreatmentDescription"
                                    data-bind="value:$root.FactorsAffectingTreatmentDescription,attr:{'required': ($root.PatientRequiresFurtherInvestigation()=='true') || $root.FactorsAffectingTreatmentDescription=='' ? 'required':null  }"
                                    rows="4"></textarea>
                            </div>
                            <!--/ko-->
                        </div>
                    </div>
                </div>
               
                <div class="widget-box">
                    <div class="widget-title">
                        <span class="icon"><i class="icon-align-justify"></i></span>
                        <h5>
                            Impact of Lifestyle</h5>
                    </div>
                    <!--ko with:CaseAssessment -->
                    <div class="widget-content">
                        <div class="form-group">
                            <!--ko foreach:$root.CaseAssessmentPatientImpacts-->
                            <label>
                                <h6>
                                    <span data-bind="text:PatientImpactName"></span>
                                </h6>
                            </label>
                            <div class="controls controls-row">
                                <div class="span10">
                                    <span class="span2">
                                        <ul class="unstyled">
                                            <!--ko foreach:$root.PatientImpactValues-->
                                            <li>
                                                <input type="radio" data-bind="attr: { name: 'CaseAssessment.CaseAssessmentPatientImpacts['+ $parentContext.$index()  + '].PatientImpactValueID', value:PatientImpactValueID},checked:$parent.PatientImpactValueID"
                                                    required />
                                                <span data-bind="text:PatientImpactValueName"></span></li>
                                            <!--/ko-->
                                        </ul>
                                    </span><span class="span9">
                                        <label>
                                            Comments:
                                        </label>
                                        <textarea class="form-control textarea-full-wd" data-bind="value:Comment,attr:{name:'CaseAssessment.CaseAssessmentPatientImpacts['+$index()+'].Comment'}"
                                            rows="3"></textarea></span>
                                </div>
                            </div>
                            <input type="hidden" data-bind="attr: { name: 'CaseAssessment.CaseAssessmentPatientImpacts['+ $index() + '].CaseAssessmentPatientImpactID' }, value: CaseAssessmentPatientImpactID" />
                            <input type="hidden" data-bind="attr: { name: 'CaseAssessment.CaseAssessmentPatientImpacts['+ $index() + '].PatientImpactID' }, value: PatientImpactID" />
                            <input type="hidden" data-bind="attr: { name: 'CaseAssessment.CaseAssessmentPatientImpacts['+ $index() + '].CaseAssessmentDetailID' }, value:$parent.CaseAssessmentDetail.CaseAssessmentDetailID" />
                            <!--/ko-->
                        </div>
                    </div>
                    <!--/ko-->
                </div>
             
                <div class="widget-box">
                    <div class="widget-title">
                        <span class="icon"><i class="icon-align-justify"></i></span>
                        <h5>
                            Impact on Work</h5>
                    </div>
                    <div class="widget-content">
                        <!--ko with:CaseAssessment -->
                        <div class="form-group">
                            <label>
                                Patient's Occupation:
                            </label>
                            <textarea readonly class="form-control textarea-qurtr" name="CaseAssessment.PatientOccupation" data-bind="value:PatientOccupation"
                                rows="3" required></textarea>
                        </div>
                        <br />
                        <div class="form-group">
                            <label>
                                Is the patient’s role Manual, Sedentary or Mixed?
                            </label>
                            <input type="text" readonly class="input-large" data-bind="value:$root.PatientRoleName" />
                            <input type="hidden" data-bind="value:PatientRoleID" name="CaseAssessment.PatientRoleID" />
                        </div>
                        <!--/ko -->
                        <br />
                        <div class="form-group">
                            <!--ko with:CaseAssessment -->
                            <span class="span3">Was the patient working at the time of the accident? </span>
                             <span class="pull-right">
                            <input type="radio" class="radio-1 inline" value="true" data-bind="checked:$root.WasPatientWorkingAtTheTimeOfTheAccident,enable:false" />Yes
                            <input type="radio" class="radio-1 inline" value="false" data-bind="checked:$root.WasPatientWorkingAtTheTimeOfTheAccident,enable:false" />No
                            <input type="radio" class="radio-1 inline" value="null" data-bind="checked:$root.WasPatientWorkingAtTheTimeOfTheAccident,enable:false" />Not
                            Applicable
                            </span>
                            <input type="hidden" data-bind="value:$root.WasPatientWorkingAtTheTimeOfTheAccident"
                                name="CaseAssessment.WasPatientWorkingAtTheTimeOfTheAccident" />
                            <div class="clear">
                            </div>
                            <label class="label-line">Has the patient had any time off work? </label>
                             <span class="pull-right">
                            <input type="radio" name="CaseAssessment.CaseAssessmentDetail.HasThePatientHadTimeOff"
                                class="radio-1 inline" value="true" data-bind="checked:$root.HasThePatientHadTimeOff" />Yes
                            <input type="radio" name="CaseAssessment.CaseAssessmentDetail.HasThePatientHadTimeOff"
                                class="radio-1 inline" value="false" data-bind="checked:$root.HasThePatientHadTimeOff" />No
                            <input type="radio" name="CaseAssessment.CaseAssessmentDetail.HasThePatientHadTimeOff"
                                class="radio-1 inline" value="null" data-bind="checked:$root.HasThePatientHadTimeOff" />Not
                            Applicable
                                 </span>
                            <div class="clear">
                            </div>
                            <label class="label-line">Has the patient returned to work? </label>
                             <span class="pull-right">
                            <input type="radio" name="CaseAssessment.CaseAssessmentDetail.HasThePatientReturnedToWork"
                                class="radio-1 inline" value="true" data-bind="checked:$root.HasThePatientReturnedToWork" />Yes
                            <input type="radio" name="CaseAssessment.CaseAssessmentDetail.HasThePatientReturnedToWork"
                                class="radio-1 inline" value="false" data-bind="checked:$root.HasThePatientReturnedToWork" />No
                            <input type="radio" name="CaseAssessment.CaseAssessmentDetail.HasThePatientReturnedToWork"
                                class="radio-1 inline" value="null" data-bind="checked:$root.HasThePatientReturnedToWork" />Not
                            Applicable
                             </span>
                            <div class="clear">
                            </div>
                            <div class="control-group">
                                <label class="control-label-inital-1">
                                    If they have been absent, how many days/weeks have they been absent?</label>
                                <div class="controls">
                                    <span class="span3">
                                        <input type="text" data-validation-regex-regex="^(\d*\.\d{1,2}|\d+)$" data-validation-regex-message="Must be a number"
                                            name="CaseAssessment.CaseAssessmentDetail.AbsentPeriod" data-bind="value:CaseAssessmentDetail.AbsentPeriod,jqBootstrapValidation:{}"
                                            class="input-small" required /></span>
                                    <select class="select-55-wd" name="CaseAssessment.CaseAssessmentDetail.AbsentPeriodDurationID" data-bind="jqBootstrapValidation:{},options:$root.Durations, optionsText:'DurationName',optionsValue:'DurationID',value:CaseAssessmentDetail.AbsentPeriodDurationID">
                                    </select>
                                </div>
                            </div>
                            <div class="clear">
                            </div>
                            <br />
                            <span class="label-line">Is the patient still suffering a financial loss as a result of being
                                off work? </span>
                           <span class="pull-right"> <input type="radio" name="CaseAssessment.IsPatientSufferingFinancialLoss" class="radio inline"
                                value="true" data-bind="checked:IsPatientSufferingFinancialLoss().toString()" />Yes
                            <input type="radio" name="CaseAssessment.IsPatientSufferingFinancialLoss" class="radio inline"
                                value="false" data-bind="checked:IsPatientSufferingFinancialLoss().toString()" />No       </span>                        
                            <div class="clear">
                            </div>
                            <div class="control-group">
                                <label class="control-label-left">
                                    <h5>
                                        Current work status</h5>
                                </label>
                                    <div class="form-group-inital">
                                      
                                        <label>
                                            @* <span class="span3" name="PatientWorkstatusName" data-bind="text:PatientWorkstatusName"> </span>
                                            <input type="radio" name="CaseAssessment.CaseAssessmentDetail.PatientWorkstatusID"
                                                class="radio inline" data-bind="attr: {value: PatientWorkstatusID},checked:$parent.CaseAssessmentDetail.PatientWorkstatusID" />*@
                                             <select name="CaseAssessment.CaseAssessmentDetail.PatientWorkstatusID" data-bind="options:$root.PatientWorkstatuses,optionsText: 'PatientWorkstatusName',optionsValue:'PatientWorkstatusID', value:CaseAssessmentDetail.PatientWorkstatusID ">
                    </select>
               
                                        </label>
                                        <br />
                                     
                                      </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label-left">
                                    <h5>
                                        Current impact on work</h5>
                                </label>
                               
                                    <div class="form-group-inital">
                                  
                                        <label>
                                              @*<span class="span3" name="PatientImpactOnWorkName" data-bind="text:PatientImpactOnWorkName">
                                                None </span>
                                            <input type="radio" name="CaseAssessment.CaseAssessmentDetail.PatientImpactOnWorkID"
                                                class="radio inline" data-bind="attr: {value: PatientImpactOnWorkID},checked:$parent.CaseAssessmentDetail.PatientImpactOnWorkID" />*@
                                          <select name="CaseAssessment.CaseAssessmentDetail.PatientImpactOnWorkID" data-bind="options:$root.PatientImpactOnWorks,optionsText: 'PatientImpactOnWorkName',optionsValue:'PatientImpactOnWorkID', value:CaseAssessmentDetail.PatientImpactOnWorkID ">
                                                </select>
                                        </label>
                                        <br />
                                                  </div>
                            </div>
                            <!--/ko -->
                        </div>
                    </div>
                </div>
              
                
                
                <div class="widget-box">
                    <div class="widget-title">
                        <span class="icon"><i class="icon-align-justify"></i></span>
                        <h5>
                            Treatment Recommendation
                        </h5>
                    </div>
                    <div class="widget-content">
                        <!--ko with:CaseAssessment -->
                        <div class="control-group">
                            <label class="control-label-inital-1">
                                How many sessions do you recommend?</label>
                            <div class="controls">
                                <input class="input-text-set" data-validation-regex-regex="^(\d*\.\d{1,2}|\d+)$" data-validation-regex-message="Must be a number"
                                    data-bind="value:CaseAssessmentDetail.PatientRecommendedTreatmentSessions,jqBootstrapValidation:{}"
                                    name="CaseAssessment.CaseAssessmentDetail.PatientRecommendedTreatmentSessions"
                                    type="text" required />
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label-inital-1">
                                Please provide any additional details on the treatment programme.</label>
                            <div class="controls">
                                <textarea class="textarea-leset" rows="3" name="CaseAssessment.CaseAssessmentDetail.PatientRecommendedTreatmentSessionsDetail"
                                    data-bind="text:CaseAssessmentDetail.PatientRecommendedTreatmentSessionsDetail"></textarea>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label-inital-1">
                                Over what period should these be carried out?
                            </label><div id="divSpaceHeight" class="hide-height"></div>
                            <div class="controls">

                                <select id="ddlTreatmentPeriodType" class="textarea-leset-1" name="CaseAssessment.CaseAssessmentDetail.TreatmentPeriodTypeID"
                                    data-bind=" click :$root.changeTreatmentPeriod, options:$root.TreatmentPeriodTypes, optionsText: 'TreatmentPeriodTypeDesc', optionsValue:'TreatmentPeriodTypeID', value:$root.PatientTreatmentPeriodTypeID">
                                </select>
                                <input type="hidden" name="CaseAssessment.CaseAssessmentDetail.TreatmentPeriodTypeID" data-bind="value: $root.PatientTreatmentPeriodTypeID" />
                                <div id="divTreatmentPeriodOther" class="hide">
                                    <input id="txtPatientTreatmentPeriod" class="width-set-50" data-bind="value:$root.PatientTreatmentPeriod" name="CaseAssessment.CaseAssessmentDetail.PatientTreatmentPeriod" />
                                    <select class="select-half-wd" name="CaseAssessment.CaseAssessmentDetail.PatientTreatmentPeriodDurationID"
                                        data-bind="options:$root.Durations,optionsText: 'DurationName', optionsValue:'DurationID',value:CaseAssessmentDetail.PatientTreatmentPeriodDurationID">
                                    </select>
                                </div>
                                @*<span class="span3">
                                    <input data-validation-regex-regex="^(\d*\.\d{1,2}|\d+)$" data-validation-regex-message="Must be a number"
                                        data-bind="value:CaseAssessmentDetail.PatientTreatmentPeriod,jqBootstrapValidation:{}"
                                        name="CaseAssessment.CaseAssessmentDetail.PatientTreatmentPeriod" type="text"
                                        required /></span>
                                <select class="select-s-half" name="CaseAssessment.CaseAssessmentDetail.PatientTreatmentPeriodDurationID"
                                    data-bind="options:$root.Durations, optionsText:'DurationName',optionsValue:'DurationID',value:CaseAssessmentDetail.PatientTreatmentPeriodDurationID"
                                    required>
                                </select>*@
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label-inital-1">
                                What is the anticipated date of discharge?</label>
                            <div class="controls">
                                <input class="input-text-set" id="AnticipatedDateOfDischarge" data-validation-regex-message="DD/MM/YYYY" data-validation-regex-regex="^(0[1-9]|[12][0-9]|3[01])[- /.](0[1-9]|1[012])[- /.](19|20)\d\d+$" data-bind="value:AnticipatedDateOfDischarge,jqBootstrapValidation:{}"
                                    class="input-small datepicker" name="CaseAssessment.AnticipatedDateOfDischarge"
                                    type="text" required />
                                <input type="hidden" name="CaseAssessment.CaseAssessmentDetail.AssessmentDate" value="@DateTime.Now" />
                            </div>
                        </div>
                        <!--/ko -->
                        <br />
                        <!--ko with:CaseAssessment -->
                        <div class="form-group">
                            <span class="span3">Has the patient been given a home exercise programme? </span>                          
                         <span class="pull-right">   <input type="radio" class="radio inline" name="CaseAssessment.HasPatientHomeExerciseProgramme"
                                value="true" data-bind="checked:HasPatientHomeExerciseProgramme().toString()" />Yes
                            <input type="radio" class="radio inline" name="CaseAssessment.HasPatientHomeExerciseProgramme"
                                value="false" data-bind="checked:HasPatientHomeExerciseProgramme().toString()" />No      </span>                         
                        </div>
                    <div class="clear">
                        </div>
                        
                                                  
                            <div class="control-group">
                                <label class="text-left">
                                What level of recovery do you anticipate the patient will make following treatment?
                            </label>
                            
                                       <div class="form-group-inital-set">
                                        <!--ko foreach:$root.PatientLevelOfRecoveries-->
                                        <label>
                                             <span class="span3" data-bind="text:PatientLevelOfRecoveryName">None </span>
                                            <input type="radio" class="radio inline" name="CaseAssessment.CaseAssessmentDetail.PatientLevelOfRecoveryID"
                                                data-bind="attr: {value: PatientLevelOfRecoveryID},checked:$parent.CaseAssessmentDetail.PatientLevelOfRecoveryID" />
                                           
                                            
                                        </label>
                                        <br />
                                        <!--/ko-->
                                    </div>
                                </div>
                            
                        <div class="clear">
                        </div>
                       
                           
                            <div class="control-group">
                                 <label>
                                What treatment method do you proposed
                            </label>
                                <div class="controls controls-row">
                                    <div class="form-group-inital-set" data-bind="foreach:$root.ProposedTreatmentMethods">
                                        <label>
                                             <span class="span3" data-bind="text:ProposedTreatmentMethodName"></span>
                                            <input type="checkbox" name="CaseAssessment.ProposedTreatmentMethodIDs" data-bind="attr: { value: ProposedTreatmentMethodID }, checked: $root.ProposedTreatmentMethodIDs"
                                                minchecked="1" data-validation-minchecked-message="Please check at least one" />
                                           
                                        </label>
                                        <br />
                                    </div>
                                </div>
                            </div>
                     
                               <div class="control-group">
                            <label class="control-label-inital-1">
                                Please provide evidence of clinical reasoning in support of treatment recommendations:</label>
                            <div class="controls">
                                   <input type="text" name="CaseAssessment.CaseAssessmentDetail.EvidenceOfClinicalReasoning" 
                                            class="input-small" data-bind="value:CaseAssessmentDetail.EvidenceOfClinicalReasoning,jqBootstrapValidation:{}" />
                            </div>
                        </div>
                        <!--/ko -->
                    </div>
                </div>
                
                
                <div class="widget-box">
                    <div class="widget-title">
                        <span class="icon"><i class="icon-align-justify"></i></span>
                        <h5>
                            Additional Information</h5>
                    </div>
                    <div class="widget-content">
                        <div class="form-group">
                            <textarea class="form-control textarea-qurtr" name="CaseAssessment.CaseAssessmentDetail.AdditionalInformation"
                                data-bind="value:$root.CaseAssessment().CaseAssessmentDetail.AdditionalInformation"
                                rows="3"></textarea>
                        </div>
                        <div class="pull-right">
                            <button class="btn btn-primary" type="button" data-bind="click:$root.PrintInitialAssessmentQA">
                                Print</button>
                        </div>
                        <div class="clear">
                        </div>
                    </div>
                </div>
                <div class="widget-box">
                    <div class="widget-title">
                        <span class="icon"><i class="icon-align-justify"></i></span>
                        <h5>
                            Rating Score</h5>
                    </div>
                    <div class="widget-content">
                        <div class="control-group">
                            <div class="form-group">
                                <div class="controls">
                                    <input class="input-text-set" type="text" min="1" max="10" data-validation-regex-regex="^(\d*\.\d{1,2}|\d+)$"
                                        data-validation-regex-message="Must be a number" name="CaseAssessment.CaseAssessmentRating.Rating"
                                        data-bind="value:$root.CaseAssessment().CaseAssessmentRating.Rating,jqBootstrapValidation:{}"
                                        required  />
                                </div>
                            </div>
                        </div>
                        <div class="clear">
                        </div>
                    </div>
                </div>                    
                <div class="widget-box">
                    <div class="widget-title">
                        <span class="icon"><i class="icon-th"></i></span>
                        <h5>
                            Further Treatment Recommended
                        </h5>
                    </div>
                    @Html.Partial("InternalTask/_AddCaseBespokePartial")
                    @Html.Partial("InternalTask/_AddCaseTreatmentPartial")
                    <div class="widget-content">
                        <a class="btn btn-small btn-primary pull-right" href="#divCreateCaseTreatmentGrid" role="button"
                            data-toggle="modal">Add</a>
                        @Html.Partial("InternalTask/_CaseTreatmentGridPartial", new { name = "CaseTreatmentPricings" })
                        <div class="clear">
                        </div>
                        <a class="btn btn-small btn-primary pull-right" href="#divCreateBespokeGrid" role="button" data-toggle="modal">
                            Add</a>
                        @Html.Partial("InternalTask/_CaseTreatmentBespokeGridPartial", new { name = "CaseBespokeServicePricing" })
                        @*<div class="form-group">
                            <div class="control-group">
                                <span class="span3">Notify Referrer?</span>
                                  
                                    <span class="pull-right">  <input type="radio" name="NotifyReferrer" data-bind="checked:IsNotifyEmailtoReferrer"
                                        class="radio inline" value="1" />Yes
                                    <input type="radio" name="NotifyReferrer" data-bind="checked:IsNotifyEmailtoReferrer"
                                        class="radio inline" value="0" />No</span>
                             <br /><br />
                                   <div class="pull-right">
                                    <span data-bind="text:UploadedDocumentName"></span>&nbsp<a class="btn btn-mini" data-bind="visible:UploadedDocumentName()!=''?true:false,click:removeAttachment"
                                        href="#"><i class="icon-remove"></i></a>&nbsp <a class="btn btn-small btn-primary"
                                            href="#divFinalVersionUpload" role="button" data-toggle="modal">Final Version Upload</a>
                                    &nbsp <a class="btn btn-small btn-primary" target="_blank" data-bind="value:CaseID, click:GenerateReport"
                                        role="button">Generate Report</a>
                                    <input type="hidden" id="caseID" data-bind="value:CaseID" />
                                </div>
                                <input type="hidden" name="CaseCommunicationHistory.NotifyReferrer" data-bind="value:NotifyReferrer" />
                            </div>
                        </div>*@
                        <div class="clear">
                        </div>
                        <div data-bind="if:IsNotifyEmailtoReferrer()==true">
                            @Html.Partial("_EmailPartial")
                        </div>
                        <br />
                        <div class="clear">
                        </div>
                        <!--ko with:CaseAssessment-->
                        <div class="form-group" data-bind="visible:$root.IsAccepted()!='true'">
                            <label>
                                Message to Supplier:
                            </label>
                            <textarea class="form-control textarea-qurtr" name="CaseAssessment.DeniedMessage" data-bind="value:DeniedMessage"
                                rows="3"></textarea>
                        </div>
                        <div class="clear">
                        </div>
                        <div class="control-group pull-right">
                            <input type="radio" class="radio-accept-1 inline" name="CaseAssessment.IsAccepted" value="true"
                                data-bind="checked:$root.IsAccepted" />
                            Accept
                            <input type="radio" class="radio-accept-1 inline" name="CaseAssessment.IsAccepted" value="false"
                                data-bind="checked:$root.IsAccepted" />
                            Reject&nbsp&nbsp&nbsp&nbsp
                            <button id="btnClinicalSave"  class="btn btn-primary" type="submit">Send</button>
                            
                        </div>
                        <!--/ko-->
                        <div class="clear">
                        </div>
                    </div>
                </div>
                @Html.Partial("_FinalVersionUploadPartial")
            }

            @using (Html.BeginForm(GlobalConst.Actions.FileController.GetGeneratedInitialAssessmentReport, GlobalConst.Controllers.File, FormMethod.Post, new { id = "frmInitialAssessmentDownloadReport" }))
            {
                @Html.AntiForgeryToken()
                <input type="hidden" name="rptCaseID" data-bind="value: CaseID" />
                <input type="hidden" name="rptCaseAssessmentDetailID" data-bind="value: CaseAssessmentDetailID" />
            }
        </div>
    </div>
</div>
<div class="row-fluid">
    <div id="footer" class="span12">
        2012 - 2013 &copy; ITS Portal v1.0
    </div>
</div>
@section AdditionalScripts{
    <script src="@Url.Content("~/Scripts/knockout/viewmodel/views/InitialAssessment/InitialAssessmentQAViewModel.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-ui.min.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery-ui-timepicker-addon.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/spin.min.js")" type="text/javascript"></script>
     <script src="@Url.Content("~/Scripts/jquery.spin.js")" type="text/javascript"></script>
    
    
    <script>
     $(function () {
        var model = @MvcHtmlString.Create(new JavaScriptSerializer().Serialize(Model));
        var initialAssessmentQAViewModel = new InitialAssessmentQAViewModel();
       initialAssessmentQAViewModel.Init(model);
        ko.applyBindings(initialAssessmentQAViewModel, $("#divInitialAssessmentQA").get(0));     
         });   
         $(document).ready(function(){
            $("#CaseAppointmentDateAppointmentDate").datepicker({
                dateFormat:'dd/mm/yy',
                    changeMonth: true,
                    changeYear: true
                });
            $("#CaseAppointmentDateAppointmentTime").timepicker();
            $("#AnticipatedDateOfDischarge").datepicker({ dateFormat: 'dd/mm/yy' });
         });

         function symptomsectiondescription(NotApplicablesymptomsection) {
             var RelevantTestUndertaken = document.getElementById("RelevantTestUndertaken");
             RelevantTestUndertaken.disabled = NotApplicablesymptomsection.checked ? true : false;
             if (!RelevantTestUndertaken) {
                 $("#RelevantTestUndertaken").prop('disabled', true);
             }

         }

         function enableDescriptionArea(NotApplicable) {
             var PreExistingConditionDescription = document.getElementById("PreExistingConditionDescription");
             PreExistingConditionDescription.disabled = NotApplicable.checked ? true : false;
             if (!PreExistingConditionDescription) {
                 $("#PreExistingConditionDescription").prop('disabled', true);
             }

         }
    </script>
}
<script type="text/javascript" src="@Url.Content("/Scripts/painScoreValidation.js")"></script>
