@using System.Web.Script.Serialization
@using ITS.Infrastructure.Global;
@model ITS.Domain.ViewModels.InternalTasksViewModel.PatientCaseAndSupplierWithPatientPostCodeViewModel
@{
    ViewBag.Title = "AcceptAndRefer";
    Layout = "~/Views/Shared/_LayoutBootstrap.cshtml";
}
@section AdditionalCss{
    <link rel="stylesheet" href="@Url.Content("~/Content/themes/base/jquery.ui.base.css")" />
    <link rel="stylesheet" href="@Url.Content("~/Content/themes/base/jquery.ui.theme.css")" />
}
@section ContentHeader{
    <h1>
        Accept And Refer</h1>
}



<div id="breadcrumb">
    <a href="@Url.Action(GlobalConst.Actions.InternalTasksController.Index, GlobalConst.Controllers.InternalTasks)" title="Go to Home" class="tip-bottom">
        <i class="icon-home"></i>Internal Tasks</a><a href="@Url.Action(@GlobalConst.Actions.ReferralController.Index, @GlobalConst.Controllers.Referral)" title="Go to Referral Recieved" class="tip-bottom">
            Referral Recieved</a><a href="#" class="tip-bottom">Accept And Refer</a>
</div>

	
<div class="container-fluid" id="divAcceptAndRefer">
    <div class="row-fluid">
        @using (Html.BeginForm(GlobalConst.Actions.ReferralController.CaseSubmitToSupplier, GlobalConst.Controllers.Referral, FormMethod.Post, new
            {
                @class = "form-horizontal",
                id = "frmReferrertoSupplier",
                encript = "multipart/form-data",
                data_bind = "ajaxForm:{ success: function(responseText, statusText, xhr, $form){ SubmitGenerateLetterForm(); UpdateAcceptAndReferFormSucess(responseText, statusText, xhr, $form);}, beforeSubmit: UpdateAcceptAndReferFormSucess}"
            }))
        {
            @Html.AntiForgeryToken()       
            
            	
           
           <!-- ko with : CasePatientTreatment -->
            <div class="widget-box">
                <div class="widget-title">
                    <span class="icon"><i class="icon-align-justify"></i></span>
                    <h5>
                        Accept And Refer</h5>
                    <!--ko if:$root.IsFileExist-->
                    <a class="label label-info" role="button" data-bind="attr:{ href: ReferralFileDownloadPath}">
                        View Attachment</a>
                    <!--/ko -->

                    <div class="controls" id="divMainDetailForm">
                           <!-- ko with : $root.CasePatientReferrerSupplierWorkflow -->
                            <a data-bind="attr: { href: '/CaseSearch/ReferralDetail/' + CaseID()}" target="_blank" class="btn btn-primary viw-refrer">View Referral</a>                            
                            <!-- /ko -->
                        </div>

                     <a data-bind="attr: { href:'/CaseSearch/CaseUpload/' + CaseID()}" target="_blank" class="btn btn-primary cse-uplod">Case Uploads</a> 
                </div>
                

            
                <div class="widget-content nopadding">
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Case Number:
                        </label>
                        <div class="controls">
                            <span data-bind="text:CaseNumber"></span>
                            <input type="hidden" name="CaseID" data-bind="value:CaseID" /></div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Title:
                        </label>
                        <div class="controls">
                            <span data-bind="text:Title"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient First Name:
                        </label>
                        <div class="controls">
                            <span data-bind="text:FirstName"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Surname :</label>
                        <div class="controls">
                            <span data-bind="text:LastName"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Address:
                        </label>
                        <div class="controls">
                            <span data-bind="text:Address"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient City:
                        </label>
                        <div class="controls">
                            <span data-bind="text:City"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Region:
                        </label>
                        <div class="controls">
                            <span data-bind="text:Region"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Post Code:
                        </label>
                        <div class="controls">
                            <span data-bind="text:PostCode" style="text-transform:uppercase"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Referrer Reference Number:</label>
                        <div class="controls">
                            <span data-bind="text:CaseReferrerReferenceNumber"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Treatment Category:
                        </label>
                        <div class="controls">
                            <span data-bind="text:TreatmentCategoryName"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Treatment Type:
                        </label>
                        <div class="controls">
                            <span data-bind="text:TreatmentTypeName"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Home Phone:
                        </label>
                        <div class="controls">
                            <span data-bind="text:HomePhone"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Work Phone:
                        </label>
                        <div class="controls">
                            <span data-bind="text:WorkPhone"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Mobile:
                        </label>
                        <div class="controls">
                            <span data-bind="text:MobilePhone"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Email:
                        </label>
                        <div class="controls">
                            <span data-bind="text:Email"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient DOI:
                        </label>
                        <div class="controls">
                            <span data-bind="text:InjuryDate"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient DOB:
                        </label>
                        <div class="controls">
                            <span data-bind="text:BirthDate"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Age:
                        </label>
                        <div class="controls">
                            <span data-bind="text:$parent.Age"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Gender:
                        </label>
                        <div class="controls">
                            <span data-bind="text:Gender"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="controls">
                            <h5>
                                Special Instructions from Referrer:
                            </h5>
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="controls">
                            <textarea readonly data-bind="value:$root.CaseSpecialInstruction" rows="3"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /ko --> 
            @*<div class="widget-box">
                <div class="widget-title">
                    <span class="icon"><i class="icon-align-justify"></i></span>
                    <h5>Referrer to Supplier</h5>
                </div>
                <div class="widget-content nopadding">
                    <table class="table table-bordered table-striped table-hover sortable">
                        <thead>
                            <tr>
                                <th>
                                    Sr.No.
                                </th>
                                <th>
                                    Distance from Patient Address
                                </th>
                                <th>
                                    Ranking
                                </th>
                                <th>
                                    Price (Avg.)<br />
                                    IA,&nbsp&nbsp RA,&nbsp&nbsp FA,&nbsp&nbsp TS
                                </th>
                                <th>
                                    Supplier Name
                                </th>
                                <th>
                                    Supplier Address
                                </th>
                                <th>
                                    Supplier Post Code
                                </th>
                                <th>
                                    Supplier Telephone
                                </th>
                                <th>
                                    Select Supplier
                                </th>
                            </tr>
                        </thead>
                        <tbody data-bind="foreach:SupplierDistanceRankPrice">
                            <tr>
                                <td>
                                    <div class="text-center">
                                        <span data-bind="text:$index()+1"></span>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-center">
                                        <span data-bind="text:Distance"></span>
                                    </div>
                                </td>
                                <td class="text-center">
                                    <span data-bind="text:RankingText"></span>
                                </td>
                                <td>
                                    <div data-bind="foreach:PriceAverages" class="text-center">
                                        <!--ko if: $index() != 0-->
                                        ,
                                        <!--/ko-->
                                        £<span data-bind="text:Price"></span>
                                    </div>
                                </td>
                                <td>
                                    <span data-bind="text:SupplierName"></span>
                                </td>
                                <td>
                                    <span data-bind="text:Address"></span>
                                </td>
                                <td>
                                    <span data-bind="text:PostCode"></span>
                                </td>
                                <td>
                                    <span data-bind="text:Phone"></span>
                                </td>
                                <td>
                                    <div class="text-center">
                                        <input type="radio" name="SupplierID" data-bind="checked:SupplierID,attr:{value:SupplierID},jqBootstrapValidation:{submitSuccess: $root.SaveValidatedClick }"
                                            required /></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>*@
            <div class="widget-box">
                <div class="widget-title">
                    <span class="icon"><i class="icon-align-justify"></i></span>
                    <h5>
                        Referrer To Supplier</h5>
                </div>
                <div class="widget-content nopadding">
                    <div class="widget-content">
                        <div class="form-group">
                            <label>
                                If the Supplier you are looking or is not displayed above, select Supplier from
                                dropdown:
                                <select id="ddlSupplierID" data-bind="options:AllSupplierWithinPostCode,  
                                                        optionsValue:'SupplierID',  
                                                        optionsText:'SupplierName',  
                                                        optionsCaption:'Choose...',  
                                                        value:$root.SelectedSupplierID">
                                </select>
                            </label>
                        </div>
                    </div>
                    <table class="table table-bordered table-striped table-hover sortable">
                        <thead>
                            <tr>
                                <th>
                                    Order #
                                </th>
                                <th>
                                    Distance from Patient Address
                                </th>
                                <th>
                                    Ranking
                                </th>
                                <th>
                                    Price (Avg.)
                                    <br />
                                    IA,&nbsp&nbsp RA,&nbsp&nbsp FA,&nbsp&nbsp TS
                                </th>
                                <th>
                                    Supplier Name
                                </th>
                                <th>
                                    Supplier Address
                                </th>
                                <th>
                                    Supplier Post Code
                                </th>
                                <th>
                                    Supplier Telephone
                                </th>
                                <th>
                                    Select Supplier
                                </th>
                            </tr>
                        </thead>
                        <tbody data-bind="with:$root.SelectedSupplier">
                            <tr>
                                <td>
                                    <div class="text-center">
                                        <span>1</span></div>
                                </td>
                                <td>
                                    <div class="text-center">
                                        <span data-bind="text:Distance"></span>
                                    </div>
                                </td>
                                <td>
                                    <span data-bind="text:RankingText"></span>
                                </td>
                                <td>
                                    <div data-bind="foreach:PriceAverages" class="text-center">
                                        <!--ko if: $index() != 0-->
                                        ,
                                        <!--/ko-->
                                        £<span data-bind="text:Price"></span>
                                    </div>
                                </td>
                                <td>
                                    <span data-bind="text:SupplierName"></span>
                                </td>
                                <td>
                                    <span data-bind="text:Address"></span>
                                </td>
                                <td>
                                    <span data-bind="text:PostCode"></span>
                                </td>
                                <td>
                                    <span data-bind="text:Phone"></span>
                                </td>
                                <td>
                                    <div class="text-center">
                                        <input type="radio" data-bind="checked:SupplierID,attr:{value:SupplierID}, jqBootstrapValidation:{submitSuccess: $root.SaveValidatedClick }"
                                            name="SupplierID" required /></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="model-footer text-center">
                <div class="controls-2">
                         <label> Message to Supplier </label>    <textarea  name="MessageToSupplier"  rows="3"></textarea>
                        </div>
                <button type="submit" class="btn btn-primary btn-set-2" data-bind="bootstrapButton : $root.SaveButtonDisable" style="margin-top:15px;">
                    Submit to Supplier</button>
            </div>
        }
    </div>
    <!-- ko with : CasePatientTreatment -->
    @using (Html.BeginForm(GlobalConst.Actions.FileController.GeneratedPatientReferrerToSupplierLetter, GlobalConst.Controllers.File, new { area = "" }, FormMethod.Post, new { id = "frmGenerateLetters" }))
    {
        @Html.AntiForgeryToken()
        <input type="hidden" id="CaseIDForGeneratePatientReferrer" name="caseID"  />
    }
    <!-- /ko -->
</div>
@section AdditionalScripts{
     <script src="@Url.Content("~/Scripts/knockout/viewmodel/views/Referral/AcceptAndReferViewModel.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/knockout/viewmodel/shared/CaseSearch/DetailFormViewModel.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-ui.min.js")"></script>
     <script src="@Url.Content("~/Scripts/spin.min.js")" type="text/javascript"></script>
     <script src="@Url.Content("~/Scripts/jquery.spin.js")" type="text/javascript"></script>
    <script type="text/javascript">

        var model = @MvcHtmlString.Create(new JavaScriptSerializer().Serialize(Model));
        var acceptAndReferViewModel = new AcceptAndReferViewModel();  
        acceptAndReferViewModel.Init(model);        
        ko.applyBindings(acceptAndReferViewModel, $("#divAcceptAndRefer").get(0));

        var detailFormViewModel = new DetailFormViewModel(model);
        detailFormViewModel.Init(model.CasePatientReferrerSupplierWorkflow, model.CasePatientTreatment.ReferralFileDownloadPath,model.CasePatientTreatment);
        ko.applyBindings(detailFormViewModel, $("#divMainDetailForm").get(0));

       

    </script>
}
