@using System.Web.Script.Serialization;
@using ITS.Infrastructure.Global;
@model ITS.Domain.ViewModels.InternalTasksViewModel.PatientCaseAndSupplierWithPatientPostCodeViewModel
@{
    ViewBag.Title = "AcceptAndReferTriageAssessment";
    Layout = "~/Views/Shared/_LayoutBootstrap.cshtml";
}
@section ContentHeader{
    <h1>
        Accept And Refer TriageAssessment</h1>
}
<div id="breadcrumb">
    <a href="@Url.Action(GlobalConst.Actions.InternalTasksController.Index, GlobalConst.Controllers.InternalTasks)" title="Go to Home" class="tip-bottom">
        <i class="icon-home"></i>Internal Tasks</a><a href="@Url.Action(@GlobalConst.Actions.ReferralController.Index, @GlobalConst.Controllers.Referral)" title="Go to Referral Recieved" class="tip-bottom">
            Referral Recieved</a><a href="#" class="tip-bottom">Accept And Refer TriageAssessment</a>
</div>
<div class="container-fluid" id="divAcceptAndReferrerTriageAssessment">
    <div class="row-fluid">
        @using (Html.BeginForm(GlobalConst.Actions.ReferralController.CaseSubmitToSupplier, GlobalConst.Controllers.Referral, FormMethod.Post, new
            {
                @class = "form-horizontal",
                id = "frmReferrertoTriageSupplier",
                encript = "multipart/form-data",
                data_bind = "ajaxForm:{ success: function(responseText, statusText, xhr, $form){ UpdateAcceptAndReferTriageFormSucess(responseText, statusText, xhr, $form);}}"
            }))
        {
            <!-- ko with : CasePatientTreatment -->
            <div class="widget-box">
                <div class="widget-title">
                    <span class="icon"><i class="icon-align-justify"></i></span>
                    <h5>
                        Accept And Refer TriageAssessment</h5>
                    <!--ko if:$root.IsFileExist-->
                    <a class="label label-info" role="button" data-bind="attr: { href: ReferralFileDownloadPath}"
                        data-toggle="modal">View Attachment</a>
                    <!--/ko -->
                </div>
                <div class="widget-content nopadding">
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Case Number:
                        </label>
                        <div class="controls">
                            <span data-bind="text:CaseNumber"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Title:
                        </label>
                        <div class="controls">
                            <span data-bind="text:Title"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient First Name:
                        </label>
                        <div class="controls">
                            <span data-bind="text:FirstName"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Surname :</label>
                        <div class="controls">
                            <span data-bind="text:LastName"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Address:
                        </label>
                        <div class="controls">
                            <span data-bind="text:Address"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient City:
                        </label>
                        <div class="controls">
                            <span data-bind="text:City"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Region:
                        </label>
                        <div class="controls">
                            <span data-bind="text:Region"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Post Code:
                        </label>
                        <div class="controls">
                            <span data-bind="text:PostCode" style="text-transform:uppercase"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Referrer Reference Number:</label>
                        <div class="controls">
                            <span data-bind="text:CaseReferrerReferenceNumber"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Treatment Category:
                        </label>
                        <div class="controls">
                            <span data-bind="text:TreatmentCategoryName"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Treatment Type:
                        </label>
                        <div class="controls">
                            <span data-bind="text:TreatmentTypeName"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Home Phone:
                        </label>
                        <div class="controls">
                            <span data-bind="text:HomePhone"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Work Phone:
                        </label>
                        <div class="controls">
                            <span data-bind="text:WorkPhone"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Mobile:
                        </label>
                        <div class="controls">
                            <span data-bind="text:MobilePhone"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Email:
                        </label>
                        <div class="controls">
                            <span data-bind="text:Email"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient DOI:
                        </label>
                        <div class="controls">
                            <span data-bind="text:InjuryDate"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient DOB:
                        </label>
                        <div class="controls">
                            <span data-bind="text:BirthDate"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Age:
                        </label>
                        <div class="controls">
                            <span data-bind="text: $parent.Age"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label-accept">
                            Patient Gender:
                        </label>
                        <div class="controls">
                            <span data-bind="text:Gender"></span>
                        </div>
                    </div>
                    <input type="hidden" name="CaseID" data-bind="value:CaseID" />
                    <div class="control-group">
                        <div class="controls">
                            <h5>
                                Special Instructions from Referrer:
                            </h5>
                        </div>
                    </div>
                    <div class="control-group">
                        <div class="controls">
                            <textarea readonly data-bind="value:$root.CaseSpecialInstruction" rows="3"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /ko -->  
            <div class="widget-box">
                <div class="widget-title">
                    <span class="icon"><i class="icon-align-justify"></i></span>
                    <h5>
                        Referrer To Supplier</h5>
                </div>
                <div class="widget-content nopadding">
                    <table class="table table-bordered table-striped table-hover sortable">
                        <thead>
                            <tr>
                                <th>
                                    Sr.No.
                                </th>
                                <th>
                                    Price (Avg.)
                                </th>
                                <th>
                                    Supplier Name
                                </th>
                                <th>
                                    Supplier Address
                                </th>
                                <th>
                                    Supplier Post Code
                                </th>
                                <th>
                                    Supplier Telephone
                                </th>
                                <th>
                                    Select Supplier
                                </th>
                            </tr>
                        </thead>
                        <tbody data-bind="foreach:TopTriageSupplierSupplierTreatmentsAndSupplierTreatmenPricing">
                            <tr>
                                <td>
                                    <span data-bind="text:$index()+1"></span>
                                </td>
                                <td>
                                    <span data-bind="text:Price"></span>
                                </td>
                                <td>
                                    <span data-bind="text:SupplierName"></span>
                                </td>
                                <td>
                                    <span data-bind="text:Address"></span>
                                </td>
                                <td>
                                    <span data-bind="text:PostCode"></span>
                                </td>
                                <td>
                                    <span data-bind="text:Phone"></span>
                                </td>
                                <td>
                                    <input type="radio" name="SupplierID" data-bind="checked:SupplierID,attr:{value:SupplierID},jqBootstrapValidation:{submitSuccess: $root.SaveValidatedClick }"
                                        required />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="widget-box">
                <div class="widget-title">
                    <span class="icon"><i class="icon-align-justify"></i></span>
                    <h5>
                        Referrer To Supplier</h5>
                </div>
                <div class="widget-content nopadding">
                    <div class="widget-content">
                        <div class="form-group">
                            <label>
                                If the Supplier you are looking or is not displayed above, select Triage Supplier
                                from dropdown:
                                <select id="ddlSupplierIDCustom" data-bind="options:AllTriageSupplierSupplierTreatmentsAndSupplierTreatmenPricing, 
                                optionsText:'SupplierName',value:SelectedTriageSupplier,
                                    optionsCaption: 'Choose...'">
                                </select>
                            </label>
                        </div>
                    </div>
                    <table class="table table-bordered table-striped table-hover sortable">
                        <thead>
                            <tr>
                                <th>
                                    Supplier Name
                                </th>
                                <th>
                                    Price (Avg.)
                                </th>
                                <th>
                                    Supplier Address
                                </th>
                                <th>
                                    Supplier Post Code
                                </th>
                                <th>
                                    Supplier Telephone
                                </th>
                                <th>
                                    Select Supplier
                                </th>
                            </tr>
                        </thead>
                        <tbody data-bind="with:SelectedTriageSupplier">
                            <tr>
                                <td>
                                    <span data-bind="text:SupplierName"></span>
                                </td>
                                <td>
                                    <span data-bind="text:Price"></span>
                                </td>
                                <td>
                                    <span data-bind="text:Address"></span>
                                </td>
                                <td>
                                    <span data-bind="text:PostCode"></span>
                                </td>
                                <td>
                                    <span data-bind="text:Phone"></span>
                                </td>
                                <td>
                                    <input type="radio" data-bind="checked:SupplierID,attr:{value:SupplierID}, jqBootstrapValidation:{submitSuccess: $root.SaveValidatedClick }"
                                        name="SupplierID" required />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="model-footer text-center">
                 <div class="controls-2">
                         <label> Message to Supplier </label>    <textarea  name="MessageToSupplier"  rows="3"></textarea>
                </div>
                <button id="btnSave" type="submit" class="btn btn-primary" data-bind="bootstrapButton : $root.SaveButtonDisable">
                    Submit to supplier</button>
            </div>
        }
    </div>
</div>
@section AdditionalScripts{
    <script src="@Url.Content("~/Scripts/knockout/viewmodel/views/Referral/AcceptAndReferTriageAssessmentViewModel.js")" type="text/javascript"></script>
    <script type="text/javascript">

        var model = @MvcHtmlString.Create(new JavaScriptSerializer().Serialize(Model));

        var acceptAndReferTriageAssessmentViewModel = new AcceptAndReferTriageAssessmentViewModel();
        acceptAndReferTriageAssessmentViewModel.Init(model);
        ko.applyBindings(acceptAndReferTriageAssessmentViewModel, $("divAcceptAndReferrerTriageAssessment").get(0));
        
      

    </script>
}
